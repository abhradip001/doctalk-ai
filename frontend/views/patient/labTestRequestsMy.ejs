<%- include('../shared/header') %>
<div class="max-w-5xl mx-auto mt-10 px-4">
  <h1 class="text-2xl font-bold text-blue-600 mb-4">My Lab Test Requests</h1>

  <% if (!requests.length) { %>
    <p class="text-gray-600">No lab test requests yet.</p>
  <% } else { %>
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow rounded">
      <thead class="bg-blue-500 text-white">
        <tr>
          <th class="py-2 px-4 text-left">Test</th>
          <th class="py-2 px-4 text-left">Preferred Window</th>
          <th class="py-2 px-4 text-left">Pickup</th>
          <th class="py-2 px-4 text-left">Status</th>
          <th class="py-2 px-4 text-left">Assigned Employee</th>
          <th class="py-2 px-4 text-left">Report</th>
        </tr>
      </thead>
      <tbody>
        <% requests.forEach(r => { %>
          <tr class="border-b hover:bg-gray-50">
            <td class="py-2 px-4">
              <div class="font-semibold"><%= r.testName %></div>
              <div class="text-gray-500 text-sm"><%= r.notes || '' %></div>
            </td>
            <td class="py-2 px-4">
              <%= new Date(r.preferredDate).toLocaleDateString() %>,
              <%= r.preferredTimeFrom %>–<%= r.preferredTimeTo %>
            </td>
            <td class="py-2 px-4"><%= r.pickupAddress %><br/><span class="text-gray-500"><%= r.contactPhone %></span></td>
            <td class="py-2 px-4 capitalize"><%= r.status %></td>
            <td class="py-2 px-4">
              <% if (r.assignedEmployee && r.assignedEmployee.name) { %>
                <div><strong><%= r.assignedEmployee.name %></strong> (<%= r.assignedEmployee.employeeId || '—' %>)</div>
                <div><%= r.assignedEmployee.phone || '' %></div>
                <% if (r.assignedEmployee.visitDate) { %>
                  <div>Visit: <%= new Date(r.assignedEmployee.visitDate).toLocaleString() %> <%= r.assignedEmployee.visitTime || '' %></div>
                <% } %>
              <% } else { %>
                <span class="text-gray-400">Not assigned</span>
              <% } %>
            </td>
            <td class="py-2 px-4">
              <% if (r.reportFilename) { %>
                <a class="text-blue-600 underline" href="/uploads/lab-tests/<%= r.reportFilename %>" target="_blank">Download</a>
              <% } else { %>
                <span class="text-gray-400">Not available</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <% } %>
</div>
<%- include('../shared/footer') %>
