<%- include('../shared/header') %>

<section class="bg-gradient-to-r from-blue-50 to-blue-100 py-10">
  <div class="max-w-6xl mx-auto px-4 text-center">
    <h1 class="text-4xl font-extrabold text-blue-700 mb-3">Find Your Doctor</h1>
    <p class="text-gray-600 text-lg">Browse trusted and verified doctors for your health needs</p>
  </div>
</section>

<div class="max-w-6xl mx-auto mt-10 px-4">
  <!-- Search & Filter -->
  <form method="GET" action="/patient/doctorList"
        class="bg-white shadow-md rounded-xl p-6 flex flex-col md:flex-row md:items-end md:space-x-4 mb-8 space-y-4 md:space-y-0 border border-gray-100">
    <div class="flex flex-col flex-1">
      <label for="specialization" class="font-semibold text-gray-700 mb-2">Specialization</label>
      <select name="specialization" id="specialization"
              class="border px-3 py-2 rounded focus:ring-2 focus:ring-blue-400 focus:outline-none">
        <option value="">All</option>
        <option value="Cardiology">Cardiologist</option>
        <option value="Dermatology">Dermatologist</option>
        <option value="Neurology">Neurologist</option>
        <option value="Pediatrics">Pediatrician</option>
        <option value="General">General</option>
      </select>
    </div>
    <div class="flex flex-col flex-1">
      <label for="experience" class="font-semibold text-gray-700 mb-2">Min Experience (Years)</label>
      <input type="number" name="experience" id="experience"
             class="border px-3 py-2 rounded focus:ring-2 focus:ring-blue-400 focus:outline-none"
             placeholder="e.g., 5" min="0">
    </div>
    <button type="submit"
            class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition shadow-md">
      Filter
    </button>
  </form>

  <!-- Doctors Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    <% if (!doctors || doctors.length === 0) { %>
      <p class="text-gray-600 text-lg col-span-3 text-center">No doctors available for the selected criteria.</p>
    <% } else { %>
      <% doctors.forEach(function(doctor){ 
           const imgSrc = doctor.profileImage ? ('/' + doctor.profileImage) : '/images/doctor-avatar.jpg';
           const spec = doctor.specialization || 'General';
           const exp = (typeof doctor.experience === 'number' ? doctor.experience : (doctor.experience || 0));
           const fee = (typeof doctor.fee === 'number' ? doctor.fee : (doctor.fee || 0));
           const avail = doctor.availability || {};
           const days = Array.isArray(avail.days) ? avail.days : [];
      %>
        <div class="bg-white rounded-xl shadow hover:shadow-xl transform hover:scale-105 transition duration-300 p-6 flex flex-col">
          <div class="flex justify-center">
            <img
              src="<%= imgSrc %>"
              alt="Dr. <%= doctor.name %> profile photo"
              class="w-24 h-24 rounded-full border-4 border-blue-100 shadow mb-4 object-cover"
              onerror="this.onerror=null;this.src='/images/doctor-avatar.jpg';"
            >
          </div>

          <h2 class="text-xl font-semibold text-center text-gray-800"><%= doctor.name %></h2>
          <p class="text-blue-600 font-medium text-center">
            <%= spec %>
          </p>

          <p class="text-gray-500 text-center mt-1">
            Experience: <%= exp %> <%= +exp === 1 ? 'year' : 'years' %>
          </p>
          <p class="text-gray-500 text-center mb-4">
            Fee: ₹<%= fee %>
          </p>

          <!-- Weekly Availability -->
          <div class="mb-4">
            <h3 class="font-semibold text-gray-700 mb-2 text-center">Weekly Availability</h3>
            <% if (days.length > 0) { %>
              <p class="text-gray-600 text-sm text-center">
                <%= days.join(', ') %><br>
                <%= avail.startTime || '—' %> - <%= avail.endTime || '—' %>
              </p>
            <% } else { %>
              <p class="text-gray-500 text-center">No availability info</p>
            <% } %>
          </div>

          <a href="/patient/appointment/<%= doctor._id %>"
             class="mt-auto bg-blue-500 text-white px-5 py-2 rounded-lg text-center hover:bg-blue-600 transition">
            Book Appointment
          </a>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>

<%- include('../shared/footer') %>
