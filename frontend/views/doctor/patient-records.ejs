<%- include('../shared/header') %>

<div class="max-w-5xl mx-auto mt-10 px-4">
  <!-- Header / breadcrumb -->
  <div class="flex items-center justify-between mb-4">
    <div>
      <h1 class="text-2xl font-bold text-blue-600">
        Patient Records (Doctor Notes)
      </h1>
      <% if (typeof patientName !== 'undefined' && patientName) { %>
        <p class="text-sm text-gray-600 mt-1">Patient: <span class="font-medium"><%= patientName %></span></p>
      <% } %>
    </div>
    <div class="text-sm">
      <a href="/doctor/dashboard" class="text-blue-600 underline">Back to Dashboard</a>
    </div>
  </div>

  <!-- Add Note (only for doctors) -->
  <% if (currentUser && currentUser.role === 'doctor') { %>
    <form action="/health-records/doctor-note" method="POST" class="bg-white shadow rounded p-4 mb-6 space-y-3">
      <input type="hidden" name="patientId" value="<%= patientId %>">
      <input name="title" required placeholder="Title (e.g., Follow-up advice)" class="border p-2 rounded w-full">
      <textarea name="notes" required placeholder="Write note..." class="border p-2 rounded w-full" rows="4"></textarea>

      <% if (typeof appointmentId !== 'undefined' && appointmentId) { %>
        <input type="hidden" name="appointmentId" value="<%= appointmentId %>">
      <% } %>

      <div class="flex items-center gap-3">
        <button class="bg-blue-600 text-white px-4 py-2 rounded">Add Note</button>
        <span class="text-xs text-gray-500">Visible to patient by default</span>
      </div>
    </form>
  <% } %>

  <!-- Notes list -->
  <% if (!records || records.length === 0) { %>
    <p class="text-gray-600">No notes yet.</p>
  <% } else { %>
    <div class="space-y-4">
      <% records.forEach(r => { %>
        <div class="bg-white shadow rounded p-4">
          <div class="flex flex-wrap items-start justify-between gap-2">
            <div>
              <h3 class="font-semibold text-gray-900"><%= r.title %></h3>
              <% if (r.doctor && r.doctor.name) { %>
                <p class="text-sm text-gray-500 mt-0.5">â€” Dr. <%= r.doctor.name %></p>
              <% } %>
            </div>
            <span class="text-sm text-gray-500"><%= new Date(r.createdAt).toLocaleString() %></span>
          </div>

          <p class="mt-3 whitespace-pre-line text-gray-800"><%= r.notes %></p>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('../shared/footer') %>
