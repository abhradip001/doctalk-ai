<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doctor Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Doctor Nav (consistent across doctor pages) -->
  <nav class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center shadow">
    <div class="space-x-4">
      <a href="/doctor/dashboard" class="font-bold hover:underline">Dashboard</a>
      <a href="/doctor/appointments" class="hover:underline">Appointments</a>
      <a href="/doctor/upload-prescription" class="hover:underline">Upload Prescription</a>
      <a href="/doctor/profile" class="hover:underline">My Profile</a>
    </div>
    <a href="/auth/logout" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600">Logout</a>
  </nav>

  <main class="flex-grow">
    <div class="max-w-4xl mx-auto mt-8 p-6 bg-white rounded shadow">

      <% if (typeof saved !== 'undefined' && saved) { %>
        <div class="mb-4 p-3 rounded bg-green-100 text-green-800 border border-green-200">
          ✅ Profile saved successfully.
        </div>
      <% } %>

      <% const isEdit = (typeof mode !== 'undefined' && mode === 'edit'); %>

      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold text-blue-700">My Profile</h1>
        <% if (!isEdit) { %>
          <a href="/doctor/profile?edit=1" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Edit</a>
        <% } %>
      </div>

      <!-- READ MODE -->
      <% if (!isEdit) { %>
        <div class="flex flex-col sm:flex-row items-start gap-6">
          <img src="/<%= doctor?.profileImage ? doctor.profileImage : 'images/default-doctor.png' %>"
               alt="Doctor"
               class="w-28 h-28 rounded-full object-cover border-4 border-blue-100 shadow" />
          <div class="flex-1">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-3">
              <div>
                <div class="text-sm text-gray-500">Name</div>
                <div class="font-semibold"><%= doctor?.name || '-' %></div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Email</div>
                <div class="font-semibold"><%= doctor?.email || '-' %></div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Phone</div>
                <div class="font-semibold"><%= doctor?.phone || '-' %></div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Specialization</div>
                <div class="font-semibold"><%= doctor?.specialization || 'Not set' %></div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Experience</div>
                <div class="font-semibold"><%= doctor?.experience || 0 %> years</div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Consultation Fee</div>
                <div class="font-semibold">₹<%= doctor?.fee || 0 %></div>
              </div>
              <div class="md:col-span-2">
                <div class="text-sm text-gray-500">Availability</div>
                <div class="font-semibold">
                  <% if (doctor?.availability?.days?.length) { %>
                    <%= doctor.availability.days.join(', ') %>
                    (<%= doctor.availability.startTime || 'N/A' %> - <%= doctor.availability.endTime || 'N/A' %>)
                  <% } else { %>
                    Not set
                  <% } %>
                </div>
              </div>
              <div class="md:col-span-2">
                <div class="text-sm text-gray-500">Degree</div>
                <% if (doctor?.degreeFile) { %>
                  <a href="/<%= doctor.degreeFile %>" target="_blank" class="text-blue-600 underline">View Degree</a>
                <% } else { %>
                  <span class="font-semibold">Not uploaded</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      <% } %>

      <!-- EDIT MODE -->
      <% if (isEdit) { %>
        <form action="/doctor/profile" method="POST" enctype="multipart/form-data" class="space-y-6 mt-2">

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Specialization</label>
              <input type="text" name="specialization"
                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    value="<%= doctor?.specialization || '' %>" />
            </div>
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Experience (Years)</label>
              <input type="number" name="experience"
                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    value="<%= doctor?.experience || 0 %>" />
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Fee (₹)</label>
              <input type="number" name="fee"
                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    value="<%= doctor?.fee || 0 %>" />
            </div>
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Available Days</label>
              <select name="days" multiple
                      class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <% const daysList = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]; %>
                <% const selectedDays = (doctor?.availability?.days || []); %>
                <% daysList.forEach(day => { %>
                  <option value="<%= day %>" <%= selectedDays.includes(day) ? 'selected' : '' %>><%= day %></option>
                <% }) %>
              </select>
              <p class="text-xs text-gray-500 mt-1">Hold Ctrl (Windows) or Cmd (Mac) to select multiple</p>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Start Time</label>
              <input type="time" name="startTime"
                    value="<%= doctor?.availability?.startTime || '' %>"
                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
            </div>
            <div>
              <label class="block text-gray-700 font-semibold mb-2">End Time</label>
              <input type="time" name="endTime"
                    value="<%= doctor?.availability?.endTime || '' %>"
                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Profile Image</label>
              <input type="file" name="profileImage" accept=".jpg,.jpeg,.png"
                     class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
              <% if (doctor?.profileImage) { %>
                <p class="text-xs text-gray-500 mt-1">
                  Current: <a href="/<%= doctor.profileImage %>" target="_blank" class="underline text-blue-600">View</a>
                </p>
              <% } %>
            </div>
            <div>
              <label class="block text-gray-700 font-semibold mb-2">Degree Certificate</label>
              <input type="file" name="degreeFile" accept=".pdf,.jpg,.jpeg,.png"
                     class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
              <% if (doctor?.degreeFile) { %>
                <p class="text-xs text-gray-500 mt-1">
                  Current: <a href="/<%= doctor.degreeFile %>" target="_blank" class="underline text-blue-600">View</a>
                </p>
              <% } %>
            </div>
          </div>

          <div class="flex gap-3">
            <a href="/doctor/profile" class="px-4 py-2 rounded border text-gray-700 hover:bg-gray-50">Cancel</a>
            <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700">Save</button>
          </div>
        </form>
      <% } %>
    </div>
  </main>

  <footer class="bg-gray-800 text-white text-center p-4 mt-auto">
    &copy; <%= new Date().getFullYear() %> Clinic-AI | Doctor Panel
  </footer>
</body>
</html>
